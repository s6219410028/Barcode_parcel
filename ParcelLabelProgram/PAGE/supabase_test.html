<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Product Selector</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
</head>
<body>
    <h2>Select a Product</h2>
    
    <label for="product-dropdown">Product:</label>
    <select id="product-dropdown">
        <option value="">Loading...</option>
    </select>

    <h3>Product Details</h3>
    <label>Product Name (English):</label>
    <input type="text" id="product_name_eng" readonly><br>

    <label>Product Name (Thai):</label>
    <input type="text" id="product_name_th" readonly><br>

    <label>Company ID:</label>
    <input type="text" id="company_id" readonly><br>

    <label>Product Barcode:</label>
    <input type="text" id="product_barcode" readonly><br>

    <label>Manufacturing Date:</label>
    <input type="text" id="product_mfg" readonly><br>

    <label>Lot Number:</label>
    <input type="text" id="product_lot" readonly><br>

    <label>Expiration Date:</label>
    <input type="text" id="product_exp" readonly><br>

    <label>Unit:</label>
    <input type="text" id="unit" readonly><br>

    <script>
        const supabaseUrl = "https://cqdhhmolqaqbalapevnw.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNxZGhobW9scWFxYmFsYXBldm53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE1NzA1NjcsImV4cCI6MjA1NzE0NjU2N30.aSGjO9lqWHN-BxJDhul6iN3yDZqkNeyG6k2q3vr5e0M";
        let supabase;

        document.addEventListener("DOMContentLoaded", async function () {
            if (window.supabase) {
                supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                console.log("Supabase initialized:", supabase);
                await populateDropdown();
            } else {
                console.error("Supabase library failed to load.");
            }
        });

        async function fetchData() {
            const { data, error } = await supabase
                .from("products") // ✅ Your table name
                .select("*"); // ✅ Fetch all columns

            if (error) {
                console.error("Error fetching data:", error);
                return [];
            }

            console.log("Fetched Data:", data); // Debugging
            return data;
        }

        async function populateDropdown() {
            const dropdown = document.getElementById("product-dropdown");
            dropdown.innerHTML = "<option value=''>Select a product</option>";

            try {
                const data = await fetchData();

                if (data.length > 0) {
                    data.forEach(row => {
                        dropdown.innerHTML += `<option value="${row.id}">${row.product_name_eng} - ${row.product_name_th}</option>`;
                    });

                    // Store data for quick access later
                    dropdown.dataset.products = JSON.stringify(data);
                } else {
                    dropdown.innerHTML = "<option value=''>No data found</option>";
                }
            } catch (error) {
                console.error("Error populating dropdown:", error);
                dropdown.innerHTML = "<option value=''>Error loading data</option>";
            }
        }

        document.getElementById("product-dropdown").addEventListener("change", function () {
            const selectedId = this.value;
            const products = JSON.parse(this.dataset.products || "[]");

            // Find selected product
            const selectedProduct = products.find(p => p.id == selectedId);

            if (selectedProduct) {
                document.getElementById("product_name_eng").value = selectedProduct.product_name_eng || "";
                document.getElementById("product_name_th").value = selectedProduct.product_name_th || "";
                document.getElementById("company_id").value = selectedProduct.company_id || "";
                document.getElementById("product_barcode").value = selectedProduct.product_barcode || "";
                document.getElementById("product_mfg").value = selectedProduct.product_mfg || "";
                document.getElementById("product_lot").value = selectedProduct.product_lot || "";
                document.getElementById("product_exp").value = selectedProduct.product_exp || "";
                document.getElementById("unit").value = selectedProduct.unit || "";
            } else {
                clearFields();
            }
        });

        function clearFields() {
            document.getElementById("product_name_eng").value = "";
            document.getElementById("product_name_th").value = "";
            document.getElementById("company_id").value = "";
            document.getElementById("product_barcode").value = "";
            document.getElementById("product_mfg").value = "";
            document.getElementById("product_lot").value = "";
            document.getElementById("product_exp").value = "";
            document.getElementById("unit").value = "";
        }
    </script>
</body>
</html>
